@using GabriniCosmetics.Areas.Admin.Models.DTOs
@using Newtonsoft.Json
@model ProductView

<!-- Container-fluid starts-->
<div class="container-fluid">
    <div>
        <div class="row product-page-main p-0">
            <div class="col-xxl-4 col-md-6 box-col-6">
                <div class="card">
                    <div class="card-body">
                        <div class="product-slider owl-carousel owl-theme" id="dbrandImage">
                            @foreach (var item in Model.Subproducts)
                            {
                                <div class="item"><img src="~/uploads/@item.Image.ImagePath" alt="" /></div>
                            }
                        </div>
                        <div class="owl-carousel owl-theme" id="sync2">
                            @foreach (var item in Model.Subproducts)
                            {
                                <div id="image-@item.Id" class="cloud-zoom-thumb" onclick="selectProduct(@item.Id)" data-product-Id="@item.Id">
                                    <a href="javascript:void(0);" class="src-zoom-anchor">
                                        <img src="~/uploads/@item.Image.ImagePath" class="src-zoom-image">
                                    </a>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xxl-8 col-md-6 box-col-6 order-xxl-0 order-1">
                <div class="card">
                    <div class="card-body">
                        <div class="product-page-details">
                            <h3 class="f-w-600">@Model.NameEn</h3>
                            <h3 class="f-w-600">@Model.NameAr</h3>
                        </div>
                        <div class="product-price d-flex">
                            @if(Model.Flags.Any(x => x.FlagType == "Sale"))
                            {
                                <p>@Model.PriceAfterDiscount JOD</p>
                                <del>@Model.Price  JOD</del>

                            }else {
                                <p>@Model.Price JOD</p>
                            }
                        </div>
                        <hr />
                        <div>
                            <table class="product-page-width">
                                <tbody>
                                    <tr>
                                        <td><b>Category in english:</b></td>
                                        <td>@Model.Subcategory.Category.NameEn</td>
                                    </tr>
                                    <tr>
                                        <td><b>Category in arabic:</b></td>
                                        <td>@Model.Subcategory.Category.NameAr</td>
                                    </tr>
                                    <tr>
                                        <td><b>Sub-Category in english:</b></td>
                                        <td>@Model.Subcategory.NameEn</td>
                                    </tr>
                                    <tr>
                                        <td><b>Sub-Category in arabic:</b></td>
                                        <td>@Model.Subcategory.NameAr</td>
                                    </tr>
                                    <tr>
                                        <td><b>Sub-Product in english:</b></td>
                                        <td id="subproduct-desc-en">@Model.Subcategory.NameEn</td>
                                    </tr>
                                    <tr>
                                        <td><b>Sub-Product in arabic:</b></td>
                                        <td id="subproduct-desc-ar">@Model.Subcategory.NameAr</td>
                                    </tr>
                                    <tr>
                                        <td><b>Availability:</b></td>
                                        <td class="txt-success">In stock</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <hr />
                        <div class="col-12 d-flex gap-2 justify-content-end">
                            <a class="btn btn-primary" href="/Admin/products/Edit/@Model.Id">Edit</a>
                            <a class="btn btn-secondary" href="/Admin/products">Cancel</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="row product-page-main">
            <div class="col-sm-12">
                <ul class="nav nav-tabs border-tab nav-primary mb-0" id="top-tab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="top-home-tab" data-bs-toggle="tab" href="#top-home" role="tab" aria-controls="top-home" aria-selected="false">Description in English</a>
                        <div class="material-border"></div>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="profile-top-tab" data-bs-toggle="tab" href="#top-profile" role="tab" aria-controls="top-profile" aria-selected="false">Description in Arabic</a>
                        <div class="material-border"></div>
                    </li>
                </ul>
                <div class="tab-content" id="top-tabContent">
                    <div class="tab-pane fade active show" id="top-home" role="tabpanel" aria-labelledby="top-home-tab">
                        <p class="mb-0 m-t-20">
                            @Model.DescriptionEn
                        </p>
                    </div>
                    <div class="tab-pane fade" id="top-profile" role="tabpanel" aria-labelledby="profile-top-tab">
                        <p class="mb-0 m-t-20">
                            @Model.DescriptionAr
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Container-fluid Ends-->
@* 
<script>
    const subproducts = Array.from((@Html.Raw(Json.Serialize(Model.Subproducts)))["$values"]);
    var selectedSubproduct = subproducts[0];

    function selectProduct(id) {

        selectedSubproduct = subproducts.find(sp => sp.id == id);

        console.log(selectedSubproduct);
        changeMainImage(`../../uploads/${selectedSubproduct['image']['imagePath']}`);

        const subproductDescription = currentCulture == 'en' ? selectedSubproduct.descriptionEn : selectedSubproduct.descriptionAr;
        $("#subproduct-description").text(subproductDescription);

        if(selectedSubproduct.isAvailability)
        {
            $('#add-to-cart').prop('disabled', false);
            $('#product-quantity').prop('disabled', false);
            $('#product-quantity-minus').prop('disabled', false);
            $('#product-quantity-plus').prop('disabled', false);
            $("#stock-available").show();
            $("#stock-unavailable").hide();
        }
        else
        {
            // $('#add-to-cart').prop('disabled', true);
            $('#product-quantity').prop('disabled', true);
            $('#product-quantity-minus').prop('disabled', true);
            $('#product-quantity-plus').prop('disabled', true);
            $("#stock-available").hide();
            $("#stock-unavailable").show();
        }

        const dropdown = $('#subproduct-dropdown');
        dropdown.val(selectedSubproduct.id);
    }

     // Function to change the main image
    function changeMainImage(newSrc, isQuickView = false) {
        $('#selected-image-view').attr('href', newSrc);
        if (isQuickView) {
            // Update the image inside the quick view modal
            $('#dbrandImageQ').attr('src', newSrc);
        } else {
            // Update the main image outside the quick view
            $('#dbrandImage').attr('src', newSrc);
        }
    }

</script> *@


<script>

    document.addEventListener("DOMContentLoaded", function () {
        if (subproducts.length > 0) {
            selectProduct(subproducts[0].id);
        }
    });

         const subproducts = @Html.Raw(JsonConvert.SerializeObject(Model.Subproducts.Select(sp => new
        {
            id = sp.Id,
            descriptionEn = sp.DescriptionEn,
            descriptionAr = sp.DescriptionAr,
            isAvailability = sp.IsAvailability,
            order = sp.Order,
            imagePath = sp.Image?.ImagePath
        })));



        function selectProduct(subproductId) {
        const sp = subproducts.find(x => x.id === subproductId);
        if (!sp) return;

        // Only update the subproduct descriptions in the table
        document.getElementById("subproduct-desc-en").textContent = sp.descriptionEn || "—";
        document.getElementById("subproduct-desc-ar").textContent = sp.descriptionAr || "—";
    }
</script>

