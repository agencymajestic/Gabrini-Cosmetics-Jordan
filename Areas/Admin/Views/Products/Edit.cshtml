
@using GabriniCosmetics.Areas.Admin.Models.DTOs
@model ProductForm
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<!-- Container-fluid starts-->
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4>Edit Product</h4>
                </div>
                <div class="card-body">
                    <div class="card-wrapper border rounded-3">
                        <form href="/Admin/Products/Edit" method="post" enctype="multipart/form-data" class="row g-3" id="editForm">
                            @Html.AntiForgeryToken()
                            @Html.HiddenFor(p => p.Id)
                            <div class="col-md-12">
                                <label class="form-label" for="NameEn">Enter Name in English</label>
                                <input class="form-control" asp-for="NameEn" placeholder="Enter Name in English" required>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label" for="NameAr">Enter Name in Arabic</label>
                                <input class="form-control" asp-for="NameAr" placeholder="Enter Name in Arabic" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label" for="SubcategoryId">Select Subcategory</label>
                                <select class="form-control" asp-for="SubcategoryId">
                                    <option selected disabled>Select Subcategory</option>
                                    @foreach (CategoryDTO category in ViewBag.Categories)
                                    {
                                        <optgroup label="@category.NameEn">
                                            @foreach (SubCategoryDTO subcategory in category.SubCategories)
                                            {
                                                <option value="@subcategory.Id">@subcategory.NameEn</option>
                                            }
                                        </optgroup>
                                    }
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label" for="Price">Enter Price</label>
                                <input type="text" class="form-control" asp-for="Price" placeholder="Enter Price" required>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label" for="DescriptionEn">Enter Description in English</label>
                                <textarea class="form-control" asp-for="DescriptionEn" placeholder="Enter Description in English"></textarea>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label" for="DescriptionAr">Enter Description in Arabic</label>
                                <textarea class="form-control" asp-for="DescriptionAr" placeholder="Enter Description in Arabic"></textarea>
                            </div>
                            <div class="col-md-12">
                                <input name="FlagNames" placeholder="write some flags" value="@Model.FlagNamesString">
                            </div>
                            <input type="hidden" name="FlagNames" id="FlagNames">
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" id="IsSale" type="checkbox" asp-for="IsSale" onchange="toggleSaleFields()">
                                    <label class="form-check-label" for="IsSale">Is Sale?</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" id="IsDealOfDay" asp-for="IsDealOfDay" type="checkbox">
                                    <label class="form-check-label" for="IsDealOfDay">Is Deal Of The Day?</label>
                                </div>
                            </div>
                            <div id="saleFields" class="col-md-12 @(Model.IsSale ? "" : "d-none")">
                                <div class="col-md-12">
                                    <label class="form-label" for="PersantageSale">Enter Percentage Sale</label>
                                    <input type="number" class="form-control" asp-for="PersantageSale" placeholder="Percentage Sale">
                                </div>
                                <div class="col-md-12">
                                    <label class="form-label" for="PriceAfterDiscount">Enter Price After Discount</label>
                                    <input type="text" class="form-control" asp-for="PriceAfterDiscount" placeholder="Price After Discount">
                                </div>
                            </div>

                            <!-- Subproducts Section -->
                            <div class="col-12 mt-4">
                                @await Html.PartialAsync("_SubproductsForm", Model.Subproducts)
                            </div>

                            <div class="col-12 d-flex gap-2 justify-content-end">
                                <button class="btn btn-primary" type="submit">Save</button>
                                <a class="btn btn-secondary" href="/admin/products">Cancel</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleSaleFields() {
        var isChecked = document.getElementById("IsSale").checked;
        var saleFields = document.getElementById("saleFields");

        if (isChecked) {
            saleFields.classList.remove("d-none");
        } else {
            saleFields.classList.add("d-none");
        }
    }
</script>


<script>
     document.addEventListener("DOMContentLoaded", function () {
        const priceInput = document.getElementById("Price");
        const percentageInput = document.getElementById("PersantageSale");
        const discountedPriceInput = document.querySelector("[name='PriceAfterDiscount']");

        function updateDiscountedPrice() {
            const price = parseFloat(priceInput.value);
            const percentage = parseFloat(percentageInput.value);

            if (!isNaN(price) && !isNaN(percentage)) {
                const discount = price * (percentage / 100);
                const finalPrice = price - discount;
                discountedPriceInput.value = finalPrice.toFixed(2);
            } else {
                discountedPriceInput.value = "";
            }
        }
        percentageInput.addEventListener("blur", updateDiscountedPrice);
    });
</script>

<style>
    #drop-zone {
        height: 150px;
        cursor: pointer;
        text-align: center;
        border: 2px dashed #ccc;
    }

    #drop-zone.dragover {
        border-color: #000;
        background-color: #f0f0f0;
    }

    .img-wrapper {
        position: relative;
        display: inline-block;
        margin-right: 10px;
    }

    .img-preview {
        width: 100px;
        height: 100px;
        object-fit: cover;
    }

    .remove-btn {
        top: 12px;
        right: 4px;
        color: red;
        padding: 0;
        font-size: 16px;
    }

    .color-picker {
        width: 50px;
    }

    .color-picker-wrapper {
        position: relative;
        display: inline-block;
        margin-right: 10px;
    }

    .remove-btn {
        top: 4px;
        right: 4px;
        color: red;
        padding: 0;
        font-size: 16px;
        background: transparent;
        border: none;
        cursor: pointer;
    }

</style>